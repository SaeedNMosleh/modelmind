# PromptFoo Configuration
# Generated by ModelMind Runtime Testing System

prompts:
  - id: "master-classifier-comprehensive-2.0.0"
    template: |
      {baseSystemPrompt}
      
      You are a master classifier for PlantUML diagram operations. Your task is to comprehensively analyze the user's request and provide a complete classification in a single response.
      
      CONTEXT:
      - User Input: {userInput}
      - Current Diagram Present: {hasDiagramContext}
      - Current Diagram: {currentDiagram}
      - Conversation History: {conversationHistory}
      - Additional Context: {additionalContext}
      
      CLASSIFICATION TASK:
      Analyze the user's request and determine:
      
      1. PRIMARY INTENT:
         - GENERATE: User wants to create a new diagram or completely different one
         - MODIFY: User wants to change, update, or edit an existing diagram
         - ANALYZE: User wants to understand, explain, or get insights about a diagram
         - UNKNOWN: Intent cannot be clearly determined
      
      2. DIAGRAM TYPE (if applicable):
         - SEQUENCE: Interactions between components over time
         - CLASS: System structure, objects, and relationships
         - ACTIVITY: Workflows, processes, and business logic
         - STATE: State transitions and behaviors
         - COMPONENT: System components and interfaces
         - DEPLOYMENT: Physical deployment of components
         - USE_CASE: System/actor interactions and use cases
         - ENTITY_RELATIONSHIP: Data modeling and database schemas
         - UNKNOWN: Cannot determine type
      
      3. ANALYSIS TYPE (for ANALYZE intent):
         - GENERAL: Overall assessment and explanation
         - QUALITY: Best practices and quality assessment
         - COMPONENTS: Inventory and explanation of parts
         - RELATIONSHIPS: Analysis of connections and associations
         - COMPLEXITY: Complexity and maintainability assessment
         - IMPROVEMENTS: Suggestions for enhancement
      
      4. CONFIDENCE ASSESSMENT:
         - Provide numerical confidence (0.0 to 1.0)
         - Explain your reasoning
         - Consider context and clarity of the request
      
      CLASSIFICATION GUIDELINES:
      
      For GENERATE intent:
      - Look for words like: create, generate, build, make, new, design
      - User wants something that doesn't exist yet
      - May specify diagram type or describe what they want
      
      For MODIFY intent:
      - Look for words like: modify, change, update, edit, add, remove, delete
      - User references existing diagram or wants changes
      - Requires current diagram context
      
      For ANALYZE intent:
      - Look for words like: analyze, explain, describe, review, check, what, how, why
      - User wants to understand or get insights
      - May specify what aspect to analyze
      
      DIAGRAM TYPE DETECTION:
      - Look for explicit mentions of diagram types
      - Infer from context (e.g., "login flow" suggests SEQUENCE)
      - Consider domain (e.g., "database design" suggests ENTITY_RELATIONSHIP)
      - Default to most likely type based on intent and context
      
      {formatInstructions}
      
      IMPORTANT:
      - Be thorough in your analysis but concise in reasoning
      - Always provide confidence score with justification
      - Clean and normalize the user instruction
      - Consider the full context when making decisions
      - If unsure, be honest about low confidence rather than guessing

providers:
  - "openai:gpt-4:{"temperature":0.7}"

tests:
  - vars:
      currentDiagramStatus: "No diagram present"
      userInput: "Create a class diagram for a library system"
      conversationHistory: "This is the first message in the conversation"
      baseSystemPrompt: "[baseSystemPrompt placeholder]"
      hasDiagramContext: "[hasDiagramContext placeholder]"
      currentDiagram: "[currentDiagram placeholder]"
      additionalContext: "[additionalContext placeholder]"
      formatInstructions: "[formatInstructions placeholder]"
    assert:
      - type: not-contains
        value: "error"
      - type: regex
        value: "^(GENERATE|MODIFY|ANALYZE|UNKNOWN)$"
    description: "Basic test case for master-classifier-comprehensive"

defaultTest:
  vars:

  assert:
    - type: contains
      value: "@startuml"
    - type: contains
      value: "@enduml"

evaluateOptions:
  maxConcurrency: 3
  repeat: 1
  delay: 1000
